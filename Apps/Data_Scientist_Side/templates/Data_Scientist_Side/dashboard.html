{% extends 'Data_Scientist_Side/base_dashboard.html' %}
{% load static %}
{% block title %}Data Scientist Dashboard{% endblock %}

{% block content %}
<!-- Hero Section with Gradient Blobs -->
<div class="bg-background"
    style="position: relative; overflow: hidden; padding: var(--spacing-8) 0; margin: calc(var(--spacing-8) * -1) calc(var(--spacing-4) * -1) var(--spacing-8);">
    <!-- Gradient Blobs -->
    <div
        style="position: absolute; top: -20%; right: -10%; width: 500px; height: 500px; background: var(--blob-gradient-1); opacity: 0.4; z-index: -1;">
    </div>
    <div
        style="position: absolute; bottom: -20%; left: -10%; width: 500px; height: 500px; background: var(--blob-gradient-2); opacity: 0.4; z-index: -1;">
    </div>

    <!-- Welcome Card -->
    <div class="container">
        <div class="card card-glass"
            style="padding: var(--spacing-8); border-radius: var(--radius-xl); max-width: 800px; margin: 0 auto;">
            <div class="text-center">
                <span style="font-size: 2rem;">ðŸ”¬</span>
                <h1 class="text-3xl font-bold mb-2"
                    style="color: var(--color-text-main); margin-top: var(--spacing-2);">Welcome,
                    {{ request.user.name|default:request.user.email }}!</h1>
                <p class="text-muted-foreground">Data Scientist Dashboard - Machine Learning & Model Management</p>
            </div>
        </div>
    </div>
</div>

<!-- Stats Overview -->
<div class="mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Models Card -->
        <a href="{% url 'data_scientist:model_list' %}" style="text-decoration: none;">
            <div class="card card-glass hover:shadow-lg transition-all" style="padding: var(--spacing-6);">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-muted-foreground">ML Models</p>
                        <h3 class="text-2xl font-bold"
                            style="color: var(--color-text-main); margin-top: var(--spacing-1);">
                            {{ total_models }}</h3>
                    </div>
                    <div style="font-size: 2rem; opacity: 0.5;">ðŸ¤–</div>
                </div>
            </div>
        </a>

        <!-- Valuations Card -->
        <a href="{% url 'data_scientist:valuation_list' %}" style="text-decoration: none;">
            <div class="card card-glass hover:shadow-lg transition-all" style="padding: var(--spacing-6);">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-muted-foreground">Total Valuations</p>
                        <h3 class="text-2xl font-bold"
                            style="color: var(--color-text-main); margin-top: var(--spacing-1);">
                            {{ total_valuations }}</h3>
                    </div>
                    <div style="font-size: 2rem; opacity: 0.5;">ðŸ“Š</div>
                </div>
            </div>
        </a>

        <!-- Active Model Card -->
        <div class="card card-glass" style="padding: var(--spacing-6);">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-muted-foreground">Active Model</p>
                    <h3 class="text-lg font-bold"
                        style="color: var(--color-primary-500); margin-top: var(--spacing-1);">
                        {% if active_model %}{{ active_model.name }} v{{ active_model.version }}{% else %}None
                        {%endif%}
                    </h3>
                </div>
                <div style="font-size: 2rem; opacity: 0.5;">âœ…</div>
            </div>
        </div>

        <!-- Upload Card -->
        <a href="{% url 'data_scientist:model_upload' %}" style="text-decoration: none;">
            <div class="card card-glass hover:shadow-lg transition-all" style="padding: var(--spacing-6);">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-muted-foreground">Quick Action</p>
                        <h3 class="text-lg font-bold"
                            style="color: var(--color-primary-500); margin-top: var(--spacing-1);">
                            Upload New Model</h3>
                    </div>
                    <div style="font-size: 2rem; opacity: 0.5;">ðŸ“¤</div>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Recent Valuations Section -->
<div class="mb-8">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-semibold" style="color: var(--color-text-main);">Recent Valuations</h2>
        <a href="{% url 'data_scientist:valuation_list' %}" class="text-sm"
            style="color: var(--color-primary-500); text-decoration: none;">View All â†’</a>
    </div>

    {% if recent_valuations %}
    <div class="card card-glass" style="padding: var(--spacing-4); overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid var(--color-border);">
                    <th style="padding: var(--spacing-3); text-align: left; color: var(--color-text-main);">Project</th>
                    <th style="padding: var(--spacing-3); text-align: left; color: var(--color-text-main);">Model</th>
                    <th style="padding: var(--spacing-3); text-align: right; color: var(--color-text-main);">Price</th>
                    <th style="padding: var(--spacing-3); text-align: left; color: var(--color-text-main);">Date</th>
                </tr>
            </thead>
            <tbody>
                {% for valuation in recent_valuations %}
                <tr style="border-bottom: 1px solid var(--color-border);">
                    <td style="padding: var(--spacing-3);">
                        <span class="font-semibold" style="color: var(--color-text-main);">
                            {{ valuation.project.project_name|truncatewords:3 }}
                        </span>
                    </td>
                    <td style="padding: var(--spacing-3);">
                        <span
                            style="display: inline-flex; padding: 2px 8px; border-radius: var(--radius-md); background: var(--color-primary-100); color: var(--color-primary-700); font-size: 0.75rem;">
                            {{ valuation.model.name }} v{{ valuation.model.version }}
                        </span>
                    </td>
                    <td style="padding: var(--spacing-3); text-align: right;">
                        <span class="font-bold" style="color: var(--color-primary-600);">
                            {{ valuation.predicted_price_per_m2|floatformat:2 }} JOD/mÂ²
                        </span>
                    </td>
                    <td style="padding: var(--spacing-3);">
                        <span class="text-muted-foreground text-sm">
                            {{ valuation.created_at|date:"M d" }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="card card-glass" style="padding: var(--spacing-8); text-align: center;">
        <div style="font-size: 2rem; margin-bottom: var(--spacing-2);">ðŸ“­</div>
        <p class="text-muted-foreground">No valuations yet. Valuations appear when users make predictions.</p>
    </div>
    {% endif %}
</div>

<!-- Model Performance Section -->
<div>
    <h2 class="text-2xl font-semibold mb-4" style="color: var(--color-text-main);">Model Usage</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for model in models_with_stats %}
        <a href="{% url 'data_scientist:model_detail' model.id %}" style="text-decoration: none;">
            <div class="card card-glass hover:shadow-lg transition-all" style="padding: var(--spacing-6);">
                <div class="flex items-center gap-4">
                    <div
                        style="width: 48px; height: 48px; border-radius: var(--radius-lg); background: linear-gradient(135deg, #6366f1, #4f46e5); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
                        </svg>
                    </div>
                    <div style="flex: 1;">
                        <h3 class="font-semibold" style="color: var(--color-text-main);">{{ model.name }}</h3>
                        <p class="text-sm text-muted-foreground">v{{ model.version }}</p>
                    </div>
                    <div style="text-align: right;">
                        <p class="text-2xl font-bold" style="color: var(--color-primary-500);">
                            {{ model.valuation_count }}</p>
                        <p class="text-xs text-muted-foreground">predictions</p>
                    </div>
                </div>
            </div>
        </a>
        {% empty %}
        <div class="card card-glass" style="padding: var(--spacing-6); grid-column: span 3; text-align: center;">
            <p class="text-muted-foreground">No models uploaded yet.
                <a href="{% url 'data_scientist:model_upload' %}" style="color: var(--color-primary-500);">Upload your
                    first model</a>
            </p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}