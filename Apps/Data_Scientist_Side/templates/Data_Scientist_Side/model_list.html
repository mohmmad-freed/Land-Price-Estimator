{% extends 'Data_Scientist_Side/base_dashboard.html' %}
{% load static %}

{% block extra_css %}
<style>
    .model-title-active {
        padding-right: 80px;
    }

    .alert-success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid var(--color-primary-500);
        color: var(--color-primary-600);
    }

    .alert-error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--color-danger);
        color: var(--color-danger);
    }
</style>
{% endblock %}

{% block title %}ML Models - Data Scientist Portal{% endblock %}

{% block content %}
<!-- Hero Section with Gradient Blobs -->
<div class="bg-background"
    style="position: relative; overflow: hidden; padding: var(--spacing-8) 0; margin: calc(var(--spacing-8) * -1) calc(var(--spacing-4) * -1) var(--spacing-8);">
    <!-- Gradient Blobs -->
    <div
        style="position: absolute; top: -20%; right: -10%; width: 500px; height: 500px; background: var(--blob-gradient-1); opacity: 0.4; z-index: -1;">
    </div>
    <div
        style="position: absolute; bottom: -20%; left: -10%; width: 500px; height: 500px; background: var(--blob-gradient-2); opacity: 0.4; z-index: -1;">
    </div>

    <!-- Page Header -->
    <div class="container">
        <div class="card card-glass"
            style="padding: var(--spacing-8); border-radius: var(--radius-xl); max-width: 900px; margin: 0 auto;">
            <div class="flex items-center justify-between">
                <div class="text-center" style="flex: 1;">
                    <span style="font-size: 2rem;">ðŸ¤–</span>
                    <h1 class="text-3xl font-bold mb-2"
                        style="color: var(--color-text-main); margin-top: var(--spacing-2);">ML Models</h1>
                    <p class="text-muted-foreground">Manage machine learning models for land price predictions</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Messages -->
{% if messages %}
<div class="container mb-4" style="max-width: 1200px; margin: 0 auto;">
    {% for message in messages %}
    <div class="p-4 rounded-lg mb-2 {% if message.tags == 'success' %}alert-success{% else %}alert-error{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Action Bar -->
<div class="container mb-6" style="max-width: 1200px; margin: 0 auto;">
    <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold" style="color: var(--color-text-main);">
            {{ models|length }} Model{% if models|length != 1 %}s{% endif %}
        </h2>
        <a href="{% url 'data_scientist:model_upload' %}" class="btn btn-primary"
            style="display: inline-flex; align-items: center; gap: var(--spacing-2);">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            Upload New Model
        </a>
    </div>
</div>

<!-- Models Grid -->
<div class="container" style="max-width: 1200px; margin: 0 auto;">
    {% if models %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for model in models %}
        <div class="card card-glass hover:shadow-lg transition-all"
            style="padding: 0; overflow: hidden; position: relative;">

            <!-- Active Badge -->
            {% if model.id == active_model_id %}
            <div style="position: absolute; top: var(--spacing-4); right: var(--spacing-4); z-index: 10;">
                <div
                    style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: var(--radius-full); background: linear-gradient(135deg, var(--color-primary-400), var(--color-primary-600)); color: white; font-size: 0.75rem; font-weight: 600; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                        <polyline points="22 4 12 14.01 9 11.01" />
                    </svg>
                    Active
                </div>
            </div>
            {% endif %}

            <!-- Card Content -->
            <div style="padding: var(--spacing-6);">
                <!-- Model Icon & Title -->
                <div class="flex items-start gap-4 mb-4">
                    <div
                        style="width: 48px; height: 48px; border-radius: var(--radius-lg); background: linear-gradient(135deg, #6366f1, #4f46e5); display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: var(--shadow-md);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
                        </svg>
                    </div>
                    <div class="{% if model.id == active_model_id %}model-title-active{% endif %}" style="flex: 1;">
                        <h3 class="text-lg font-bold mb-1" style="color: var(--color-text-main); line-height: 1.3;">
                            {{ model.name }}</h3>
                        <p class="text-sm text-muted-foreground">v{{ model.version }}</p>
                    </div>
                </div>

                <!-- Divider -->
                <div style="height: 1px; background: var(--color-border); margin: var(--spacing-4) 0;"></div>

                <!-- Model Details -->
                <div class="space-y-3">
                    <p class="text-sm text-muted-foreground"
                        style="display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        {{ model.description|truncatewords:20 }}
                    </p>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted-foreground">
                            {{ model.created_at|date:"M d, Y" }}
                        </span>
                        <span class="text-sm text-muted-foreground">
                            by {{ model.created_by.name|default:model.created_by.email }}
                        </span>
                    </div>
                </div>

                <!-- Actions -->
                <div style="display: flex; gap: var(--spacing-2); margin-top: var(--spacing-4);">
                    <a href="{% url 'data_scientist:model_detail' model.id %}" class="btn btn-secondary"
                        style="flex: 1; justify-content: center; font-size: 0.875rem;">
                        View Details
                    </a>
                    {% if model.id != active_model_id %}
                    <a href="{% url 'data_scientist:model_activate' model.id %}" class="btn btn-primary"
                        style="flex: 1; justify-content: center; font-size: 0.875rem;">
                        Set Active
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="card card-glass" style="padding: var(--spacing-12); text-align: center;">
        <div style="font-size: 4rem; margin-bottom: var(--spacing-4);">ðŸ¤–</div>
        <h3 class="text-xl font-bold mb-2" style="color: var(--color-text-main);">No Models Uploaded Yet</h3>
        <p class="text-muted-foreground mb-6">Upload your first ML model to start making predictions</p>
        <a href="{% url 'data_scientist:model_upload' %}" class="btn btn-primary">
            Upload Your First Model
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}